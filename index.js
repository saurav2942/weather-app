"use strict";const userTab=document.querySelector("[data-userTab]"),searchTab=document.querySelector("[data-searchTab]"),locationPage=document.querySelector(".location"),searchPage=document.querySelector(".search"),searchInp=document.querySelector("[data-searchInp]"),searchBtn=document.querySelector(".search-btn"),weatherInfo=document.querySelector(".weather"),apiErrorContainer=document.querySelector(".api-error-container"),API_KEY="eb3f1cd41d9d551fcbcd934888d241da";let currentTab=userTab;function switchTab(e){e!=currentTab&&(currentTab.classList.remove("current-tab"),(currentTab=e).classList.add("current-tab"),searchPage.classList.contains("active")?(searchPage.classList.remove("active"),locationPage.classList.remove("active"),weatherInfo.classList.remove("active"),getFromSessionStorage()):(searchPage.classList.add("active"),locationPage.classList.remove("active"),weatherInfo.classList.remove("active")))}userTab.classList.add("current-tab"),locationPage.classList.add("active"),userTab.addEventListener("click",()=>{switchTab(userTab)}),searchTab.addEventListener("click",()=>{switchTab(searchTab)});const grantAccessBtn=document.querySelector("[data-grantAccess]"),messageText=document.querySelector("[data-messageText]"),loadingScreen=document.querySelector(".loading"),apiErrorImg=document.querySelector("[data-notFoundImg]"),apiErrorMessage=document.querySelector("[data-apiErrorText]"),apiErrorBtn=document.querySelector("[data-apiErrorBtn]");function getFromSessionStorage(){let e=sessionStorage.getItem("user-coordinates");if(e){let a=JSON.parse(e);fetchUserWeatherInfo(a)}else locationPage.classList.add("active")}function getLocation(){navigator.geolocation?navigator.geolocation.getCurrentPosition(showPosition,showError):(grantAccessBtn.style.display="none",messageText.innerText="Geolocation is not supported by this browser.")}function showPosition(e){let a={lat:e.coords.latitude,lon:e.coords.longitude};sessionStorage.setItem("user-coordinates",JSON.stringify(a)),fetchUserWeatherInfo(a)}function showError(e){switch(e.code){case e.PERMISSION_DENIED:messageText.innerText="You denied the request for Geolocation.";break;case e.POSITION_UNAVAILABLE:messageText.innerText="Location information is unavailable.";break;case e.TIMEOUT:messageText.innerText="The request to get user location timed out.";break;case e.UNKNOWN_ERROR:messageText.innerText="An unknown error occurred."}}async function fetchUserWeatherInfo(e){let{lat:a,lon:t}=e;locationPage.classList.remove("active"),loadingScreen.classList.add("active");try{let r=await fetch(`https://api.openweathermap.org/data/2.5/weather?lat=${a}&lon=${t}&appid=${API_KEY}&units=metric`),s=await r.json();if(!s.sys)throw s;loadingScreen.classList.remove("active"),weatherInfo.classList.add("active"),renderWeatherInfo(s)}catch(n){loadingScreen.classList.remove("active"),apiErrorContainer.classList.add("active"),apiErrorImg.style.display="none",apiErrorMessage.innerText=`Error: ${n?.message}`,apiErrorBtn.addEventListener("click",fetchUserWeatherInfo)}}function renderWeatherInfo(e){let a=document.querySelector("[data-cityName]"),t=document.querySelector("[data-flagIcon]"),r=document.querySelector("[data-desc]"),s=document.querySelector("[data-descIcon]"),n=document.querySelector("[data-temprature]"),c=document.querySelector("[data-windspeed]"),o=document.querySelector("[data-humidity]"),i=document.querySelector("[data-cloudiness]");a.innerText=e?.name,t.src=`https://flagcdn.com/144x108/${e?.sys?.country.toLowerCase()}.png`,r.innerText=e?.weather?.[0]?.main,s.src=`http://openweathermap.org/img/w/${e?.weather?.[0]?.icon}.png`,n.innerText=`${e?.main?.temp.toFixed(2)} \xb0C`,c.innerText=`${e?.wind?.speed.toFixed(2)}m/s`,o.innerText=`${e?.main?.humidity}%`,i.innerText=`${e?.clouds?.all}%`}async function fetchSearchWeatherInfo(e){loadingScreen.classList.add("active"),weatherInfo.classList.remove("active"),apiErrorContainer.classList.remove("active");try{let a=await fetch(`https://api.openweathermap.org/data/2.5/weather?q=${e}&appid=${API_KEY}&units=metric`),t=await a.json();if(!t.sys)throw t;loadingScreen.classList.remove("active"),weatherInfo.classList.add("active"),renderWeatherInfo(t)}catch(r){loadingScreen.classList.remove("active"),apiErrorContainer.classList.add("active"),apiErrorMessage.innerText=`${r?.message}`,apiErrorBtn.style.display="none"}}getFromSessionStorage(),grantAccessBtn.addEventListener("click",getLocation),searchInp.addEventListener("keyup",e=>{"Enter"===event.key&&(e.preventDefault(),""!==searchInp.value&&(fetchSearchWeatherInfo(searchInp.value),searchInp.value=""))}),searchBtn.addEventListener("click",e=>{e.preventDefault(),""!==searchInp.value&&(fetchSearchWeatherInfo(searchInp.value),searchInp.value="")});

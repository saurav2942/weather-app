"use strict";const userTab=document.querySelector("[data-userTab]"),searchTab=document.querySelector("[data-searchTab]"),locationPage=document.querySelector("[data-locationPage]"),messageText=document.querySelector("[data-messageText]"),grantAccess=document.querySelector("[data-grantAccessBtn]"),searchPage=document.querySelector("[data-searchPage]"),searchInp=document.querySelector("[data-searchInp]"),searchBtn=document.querySelector("[data-searchBtn]"),loadingPage=document.querySelector("[data-loadingPage]"),apiErrorPage=document.querySelector("[data-apiErrorPage]"),apiErrorImg=document.querySelector("[data-notFoundImg]"),apiErrorMessage=document.querySelector("[data-apiErrorText]"),apiErrorBtn=document.querySelector("[data-apiErrorBtn]"),weatherPage=document.querySelector("[data-weatherPage]"),cityName=document.querySelector("[data-cityName]"),countryIcon=document.querySelector("[data-countryIcon]"),desc=document.querySelector("[data-desc]"),weatherIcon=document.querySelector("[data-weatherIcon]"),temprature=document.querySelector("[data-temprature]"),windspeed=document.querySelector("[data-windspeed]"),humidity=document.querySelector("[data-humidity]"),cloudiness=document.querySelector("[data-cloudiness]"),API_KEY="eb3f1cd41d9d551fcbcd934888d241da";let currentTab=userTab;function switchTabs(e){currentTab!=e&&(currentTab.classList.remove("current-tab"),(currentTab=e).classList.add("current-tab"),searchPage.classList.contains("active")?(searchPage.classList.remove("active"),weatherPage.classList.remove("active"),getFromSessionStorage()):(locationPage.classList.remove("active"),searchPage.classList.add("active"),weatherPage.classList.remove("active")))}function getFromSessionStorage(){let e=sessionStorage.getItem("user-coordinates");if(e){let a=JSON.parse(e);fetchUserWeatherInfo(a)}else locationPage.classList.add("active")}function getLocation(){navigator.geolocation?navigator.geolocation.getCurrentPosition(getPosition,showError):(grantAccess.style.display="none",messageText.innerText="Geolocation is not supported by this browser.")}function getPosition(e){let a={lat:e.coords.latitude,lon:e.coords.longitude};sessionStorage.setItem("user-coordinates",JSON.stringify(a)),fetchUserWeatherInfo(a)}function showError(e){switch(console.log(e),e.code){case e.PERMISSION_DENIED:messageText.innerText="You denied the request for Geolocation.";break;case e.POSITION_UNAVAILABLE:messageText.innerText="Location information is unavailable.";break;case e.TIMEOUT:messageText.innerText="The request to get user location timed out.";break;case e.UNKNOWN_ERROR:messageText.innerText="An unknown error occurred."}}async function fetchUserWeatherInfo(e){let{lat:a,lon:t}=e;apiErrorPage.classList.remove("active"),locationPage.classList.remove("active"),loadingPage.classList.add("active");try{let r=await fetch(`https://api.openweathermap.org/data/2.5/weather?lat=${a}&lon=${t}&appid=${API_KEY}&units=metric`),s=await r.json();if(!s.sys)throw s;loadingPage.classList.remove("active"),weatherPage.classList.add("active"),renderWeatherInfo(s)}catch(c){loadingPage.classList.remove("active"),apiErrorPage.classList.add("active"),apiErrorImg.style.display="none",apiErrorMessage.innerText=`Error: ${c?.message}`,apiErrorBtn.addEventListener("click",fetchUserWeatherInfo)}}function renderWeatherInfo(e){cityName.innerText=e?.name,countryIcon.src=`https://flagcdn.com/144x108/${e?.sys?.country.toLowerCase()}.png`,desc.innerText=e?.weather?.[0]?.main,weatherIcon.src=`http://openweathermap.org/img/w/${e?.weather?.[0]?.icon}.png`,temprature.innerText=`${e?.main?.temp.toFixed(2)} \xb0C`,windspeed.innerText=`${e?.wind?.speed.toFixed(2)}m/s`,humidity.innerText=`${e?.main?.humidity}%`,cloudiness.innerText=`${e?.clouds?.all}%`}async function fetchSearchWeatherInfo(e){loadingPage.classList.add("active"),weatherPage.classList.remove("active"),apiErrorPage.classList.remove("active");try{let a=await fetch(`https://api.openweathermap.org/data/2.5/weather?q=${e}&appid=${API_KEY}&units=metric`),t=await a.json();if(!t.sys)throw t;loadingPage.classList.remove("active"),weatherPage.classList.add("active"),renderWeatherInfo(t)}catch(r){loadingPage.classList.remove("active"),apiErrorPage.classList.add("active"),apiErrorMessage.innerText=`${r?.message}`,apiErrorBtn.style.display="none"}}currentTab.classList.add("current-tab"),userTab.addEventListener("click",e=>{switchTabs(userTab)}),searchTab.addEventListener("click",e=>{switchTabs(searchTab)}),getFromSessionStorage(),grantAccess.addEventListener("click",getLocation),searchInp.addEventListener("keyup",e=>{"Enter"===e.key&&(e.preventDefault(),""!==searchInp.value&&(fetchSearchWeatherInfo(searchInp.value),searchInp.value=""))}),searchBtn.addEventListener("click",e=>{e.preventDefault(),""!==searchInp.value&&(fetchSearchWeatherInfo(searchInp.value),searchInp.value="")});
